#!/bin/bash -e

cd "$(dirname "$0")"

BASE=$(pwd)

# Production environment (don't want to open development panel).
export NODE_ENV=production

# Make sure the app runs on the screen.
export DISPLAY=:0

# Kill running background jobs on exit.
trap 'kill 0' INT TERM EXIT

# # Prevent screen from sleeping.
xset s off
xset -dpms
xset s noblank

# # Removes cursor from screen when app is running.
unclutter -idle 0.1 -root &

start() {
    (
        cd "$BASE/$1"

        while npm start >> "$BASE/$1.stdout.log" 2>> "$BASE/$1.stderr.log" || true; do
            echo "restarting $1 in 5 seconds"
            sleep 5
        done
    ) &
}

start api
start chat
start gpio
start electron

wait
